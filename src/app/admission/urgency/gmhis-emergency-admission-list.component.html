<nb-card class="nbCardList">
    <nb-card-header class="row d-flex justify-content-between align-items-center">
      <div class="col-lg-7 col-md-3 col-sm-12">
        <h4 class="text-capitalize d-flex justify-content-start w-100 text-center">
          Urgence
        </h4>
      </div>
    </nb-card-header>
    <nb-card-body>
          <form [formGroup]="searchForm">
            <div class="row d-flex justify-content-between align-items-end mb-2">
              <div class="col-lg-11 col-md-9 col-sm-12 row">
                <div class="col-lg-11 row">       
                  <div class="col-lg-3 col-md-4 col-sm-12 mb-2 rounded-pill">
                    <input
                      type="text"
                      class="form-control"
                      formControlName="patientExternalId"
                      placeholder="N° du Patient"
                    />
                  </div> 
                  <div class="col-lg-3 col-md-4 col-sm-12 mb-2 rounded-pill">
                    <input
                      type="text"
                      class="form-control"
                      formControlName="lastName"
                      placeholder="Nom du Patient"
                    />
                  </div>           
                  <div class="col-lg-3 col-md-4 col-sm-12 mb-2 rounded-pill">
                    <ng-select formControlName="service" placeholder="service">
                        <ng-option *ngFor="let actServiceNameAndId of actServicesNameAndId" [value]="actServiceNameAndId.id">
                          {{actServiceNameAndId.name}}
                        </ng-option>
                      </ng-select>
                  </div>
                  
                  <div class="col-lg-3 col-md-4 col-sm-12 mb-2 rounded-pill">
                    <ng-select (change)="onSearchValueChange()" formControlName="admissionStatus">
                        <ng-option *ngFor="let admissionStatu of admissionStatus" [value]="admissionStatu.value">
                          {{admissionStatu.item}}
                        </ng-option>
                      </ng-select>
                  </div>
                </div>
                <div class="col-lg-1">
                  <span
                    (click)="onSearchValueChange()"
                    style="
                      background-color: #ededed;
                      color: #14a2b8;
                      cursor: pointer;
                    "
                    class="material-icons px-2 p-1 rounded"
                  >
                    search
                  </span>
                </div>
              </div>
              <div class="col-lg-1 col-md-3 col-sm-12 ">
                <ng-select
                  [(ngModel)]="selectedSize"
                  formControlName="size"
                  (change)="onSearchValueChange()"
                >
                  <ng-option *ngFor="let size of sizes" [value]="size.id">{{
                    size.value
                  }}</ng-option>
                </ng-select>
              </div>
            </div>
          </form>   
      <div class="tableFixHead">
        <table class="table table-bordered table-hover table-md align-middle">
          <thead class="pb-3 text-capitalize">
            <tr class="pb-3">
              <th>Date</th>
              <th>N° Admission</th>
              <th>N° patient</th>
              <th>Patient</th>
              <th>Service</th>
              <th>Motif</th>
              <th>Médecin</th> 
              <th>Caution</th>
              <th>Etat</th>
              <th>Actions</th>   
            </tr>
          </thead>
  
          <tbody>
            <tr
              *ngFor="
                let admission of items
                  | paginate
                    : {
                        itemsPerPage: selectedSize,
                        currentPage: currentPage,
                        totalItems: totalItems
                      };
                let i = index
              "
              [class.active]="i == currentIndex"
              (click)="rowSelected(commune, i)"
              >
              <td class="text-nowrap ">{{admission.admissionDate | date:  "dd/MM/yyyy HH:mm:ss"}}</td>
              <td>{{admission?.admissionNumber | uppercase }}</td>
              <td class="text-nowrap">{{admission.patientExternalId}}</td>
              <td class="text-nowrap">{{admission.patientLastName}} {{admission.patientFirstName}}</td>
              <td class="text-nowrap">{{admission.service}}</td>
              <td class="text-nowrap">{{admission.act}}</td>
              <td class="text-nowrap"> {{admission.practician}}</td>
              <td class="text-center">{{admission.caution != null ? ( admission.caution | currency: "FCFA":"symbol":"1.0-0") : '---'}}</td>
              <td class="text-center">
                <span class="status" [ngClass]="{'statusSuccess': admission.admissionStatus == 'B', 'statusError': admission.admissionStatus == 'R'}" >{{admission.admissionStatus == 'B' ? 'Facturée' : 'Non Facturé'}}</span>
            </td>
              <td>
                <div ngbDropdown class="d-inline-block">
                  <button type="button" class="btn btn-outline-info" id="dropdownBasic1" ngbDropdownToggle>
                    ...
                  </button>
                  <div class="text" ngbDropdownMenu aria-labelledby="dropdownBasic1">
                    <button
                    (click)="openUpdateForm(updateFormContent, admission)"
                     class="text-center" 
                     ngbDropdownItem>
                     Modifier
                    </button>
                    <button 
                     class="text-center"
                    (click)="openInvoiceForm(invoiceFormContent, admission)"
                    ngbDropdownItem>Facture</button>
                    <button 
                    *ngIf="isDeposit(admission.caution)"
                    class="text-center"
                   (click)="onPrintAdmissionBailReceipt(printContent, admission)"
                   ngbDropdownItem>Réçu Caution</button>

                   <button 
                   class="text-center"
                  (click)="onRevokeConfirmation(revokeConfirmation, admission)"
                  ngbDropdownItem>Révoquer</button>
                  <button *ngIf="admission.takeCare" class="text-center" ngbDropdownItem (click)="onAdmissionSupervisory(admission.id)">Admission de Supervision</button>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="d-flex w-100 justify-content-center">
        <div
          style="color: #623508"
          *ngIf="showloading"
          class="spinner-border"
          style="width: 3rem; height: 3rem"
          role="status"
        >
          <span class="sr-only">Loading...</span>
        </div>
      </div>
      <div class="d-flex justify-content-center">
        <pagination-controls
          responsive="true"
          previousLabel="Prev"
          nextLabel="Next"
          (pageChange)="onPageChange($event)"
        >
        </pagination-controls>
      </div>
    </nb-card-body>
  </nb-card>
  
  
  <!-- update modal -->
  <ng-template #updateFormContent let-c="close" let-d="dismiss">
    <div class="modal-header">
      <h4 class="text-capitalize modal-title color-biblos" id="update-form-modal">
        Modifer une admission
      </h4>
      <nb-icon
        style="cursor: pointer"
        (click)="d('Cross click')"
        class="h4"
        icon="close-circle-outline"
      ></nb-icon>
    </div>
    <div class="modal-body">
      <app-admission-create-update
        [admission]="admission"
        (updateAdmission)="updateAdmission()"
      ></app-admission-create-update>
    </div>
  </ng-template>

  <ng-template #invoiceFormContent let-c="close" let-d="dismiss">
    <div class="modal-header">
      <h4 class="text-capitalize modal-title color-biblos" id="update-form-modal">
        Facture
      </h4>
      <nb-icon
        style="cursor: pointer"
        (click)="d('Cross click')"
        class="h4"
        icon="close-circle-outline"
      ></nb-icon>
    </div>
    <div class="modal-body">
      <app-invoice-form
        [admission]="admission"
        (addInvoice)="addInvoice()"
      ></app-invoice-form>
    </div>
  </ng-template>

    <!-- ngx-extended-pdf-viewer -->
<ng-template #printContent let-c="close" let-d="dismiss">
  <div class="modal-header bg-gray">
    <h4 class="text-capitalize modal-title" id="update-form-modal">IMPRIMER</h4>
    <nb-icon style="cursor: pointer;" (click)="d('Cross click')" class="h4"  icon="close-circle-outline"></nb-icon>
  </div>
  <div class="modal-body bg-gray">
    <ngx-extended-pdf-viewer *ngIf='docSrc' [src]="docSrc" useBrowserLocale="true" height="80vh">
    </ngx-extended-pdf-viewer>
  </div>
</ng-template>

<ng-template #revokeConfirmation let-c="close" let-d="dismiss">
  <div class="modal-header ">
    <small>Voulez vous vraiment revoquer cette admission ? si oui continuer :-)....</small>
    <nb-icon
      style="cursor: pointer"
      (click)="d('Cross click')"
      class="h4"
      icon="close-circle-outline"
    ></nb-icon>
  </div>
  <div class="modal-body d-flex justify-content-center">
      <button (click)="OnRevokeAdmission(false)" class="btn btn-danger mx-2">Nom</button>
      <button (click)="OnRevokeAdmission(true)" class="btn btn-success">Oui</button>
  </div>

</ng-template>

  