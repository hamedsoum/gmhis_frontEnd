<div class="{{ styleClass }}">
    <div  *ngIf="showAddProtocole" class="d-flex sh-justify-content-end">
        <sh-button (click)="showEditor = !showEditor" type="text" size="small" label="Ajouter un protocole" labelStyleClass="sh-color-primary mb-2"></sh-button>
    </div>

    <div  *ngIf="showEditor" style="height: 100px;" class="mb-5">
        <div
        *ngIf="loading == true"
        class="overlay d-flex justify-content-center align-items-center"
      >
        <div class="d-flex w-100 justify-content-center">
          <div
            class="spinner-border"
            style="width: 5rem; height: 5rem; color: #623508"
            role="status"
          >
            <span class="sr-only">Loading...</span>
          </div>
        </div>
      </div>
        <quill-editor *ngIf="showEditor" [modules]="quillConfiguration" [(ngModel)]="protocoleDescription"></quill-editor>
    </div>
    <div *ngIf="showEditor" class="d-flex sh-justify-content-end">
        <sh-button [disabled]="isDescription()" (click)="onAddProtocole()" type="button" size="small" label="Ajouter" labelStyleClass="sh-color-primary"></sh-button>
    </div>

<form *ngIf="showServiceEditor" [formGroup]="fieldsGroup">
  <div
  *ngIf="loading == true"
  class="overlay d-flex justify-content-center align-items-center"
>
  <div class="d-flex w-100 justify-content-center">
    <div
      class="spinner-border"
      style="width: 5rem; height: 5rem; color: #623508"
      role="status"
    >
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</div>
  <div class="row">
      <div class="col-12 mb-5">
        <label for="detail" class="form-label">Detail des soin *</label>
        <quill-editor [modules]="quillConfiguration" formControlName="detail"></quill-editor>
        <div *ngIf="formSubmitted && !fieldsGroup.controls.detail.valid">
            <small *ngIf="detail.errors.required" class="text-danger">Veuillez remplir ce champs</small>
        </div>
      </div>
      <div class="col-12 mt-5">
        <label for="serviceDate" class="form-label text-capitalize">Date et heure d'ouverture *</label>
        <input nbInput formControlName="serviceDate" class="form-control" [nbDatepicker]="dateTimePicker">
        <nb-date-timepicker format="dd-MM-yyyy HH:mm:ss" #dateTimePicker></nb-date-timepicker>
      </div>
  </div>

  <sh-button [disabled]="!this.fieldsGroup.valid" (click)="onAddProtocoleService()" type="button" size="small" label="Ajouter" labelStyleClass="sh-color-primary"></sh-button>

</form>
    <div *ngFor="let protocole of data; let first = first">
      <div class="d-flex justify-content-end">
        <sh-button *ngIf="first" (click)="onShowProtocoleServiceForm(protocole.id)" type="button" size="small" label="Ajouter un soin" labelStyleClass="sh-color-primary"></sh-button>
      </div>
        <span *ngIf="first" class="sh-color-primary mb-2"> Protocole Récent </span>
        <div *ngIf="first" class="sh-border-discrete p-2 mb-4">
          <div class="d-flex justify-content-end">
            <sh-button (click)="onShowProtocoleServices(servicesRef, protocole.id)" type="text" size="small" label="Voir les soins pratiqués" labelStyleClass="sh-color-primary"></sh-button>
          </div>
          <div  [innerHTML]="protocole.description"></div>
        </div>
        <div *ngIf="!first && showAllProtocole" class="sh-border-discrete p-2 mb-4">
          <div class="d-flex justify-content-end">
          <sh-button (click)="onShowProtocoleServices(servicesRef,protocole.id)" type="text" size="small" label="Voir les soins pratiqués" labelStyleClass="sh-color-primary"></sh-button>
          </div>
          <div  [innerHTML]="protocole.description"></div>
        </div>
    </div>
</div>

<ng-template #name>
  <div
  *ngIf="loading == true"
  class="overlay d-flex justify-content-center align-items-center"
>
  <div class="d-flex w-100 justify-content-center">
    <div
      class="spinner-border"
      style="width: 5rem; height: 5rem; color: #623508"
      role="status"
    >
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</div>
</ng-template>


<ng-template #servicesRef let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="text-capitalize modal-title color-biblos" id="add-form-modal">
      Soins Appliqués
    </h4>
    <nb-icon
      style="cursor: pointer"
      (click)="d('Cross click')"
      class="h4"
      icon="close-circle-outline"
    ></nb-icon>
  </div>
  <div class="modal-body">
    <small class="alin-center" *ngIf="protocoleServices.length == 0"> Aucun soin Appliqué suite à ce protocole</small>
    <div *ngFor="let service of protocoleServices;">
      <div  class="sh-border-discrete p-2 mb-4">
       <div class="mb-2">
        <div  [innerHTML]="service.detail"></div>
       </div>

        <div class="d-flex w-100 justify-content-between">
          <div>
            <small class="sh-display-block">Date de la Prestation</small>
            <small>{{service.serviceDate | date: "dd/MM/yyyy hh:mm:ss"}}</small>
          </div>
            <div>
              <small class="sh-display-block">Infirmer(e)</small>
              <div>{{service.nurse.firstName}} {{service.nurse.lastName}}</div>
            </div>
        </div>
      </div>
  </div>  </div>
</ng-template>